<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.house.model.dao.HouseDao">

<!-- 1) HouseInfo 매핑 -->
<resultMap id="HouseInfoResult" type="com.ssafy.house.model.dto.HouseInfo">
    <id     column="apt_seq"        property="aptSeq"/>
    <result column="sgg_cd"         property="sggCd"/>
    <result column="umd_cd"         property="umdCd"/>
    <result column="umd_nm"         property="umdNm"/>
    <result column="jibun"          property="jibun"/>
    <result column="road_nm_sgg_cd" property="roadNmSggCd"/>
    <result column="road_nm"        property="roadNm"/>
    <result column="road_nm_bonbun" property="roadNmBonbun"/>
    <result column="road_nm_bubun"  property="roadNmBubun"/>
    <result column="apt_nm"         property="aptNm"/>
    <result column="build_year"     property="buildYear"/>
    <result column="latitude"       property="latitude"/>
    <result column="longitude"      property="longitude"/>
</resultMap>

<select id="selectHouseInfo"
        parameterType="string"
        resultMap="HouseInfoResult">
    SELECT
    apt_seq,
    sgg_cd,
    umd_cd,
    umd_nm,
    jibun,
    road_nm_sgg_cd,
    road_nm,
    road_nm_bonbun,
    road_nm_bubun,
    apt_nm,
    build_year,
    latitude,
    longitude
    FROM house_info
    WHERE apt_seq = #{aptSeq}
</select>

<!-- 2) HouseDetail 매핑 -->
<resultMap id="HouseDetailResult" type="com.ssafy.house.model.dto.HouseDetail">
    <id     column="apt_seq"    property="aptSeq"/>
    <result column="apt_name"   property="aptName"/>
    <result column="dong"       property="dong"/>
    <result column="lat"        property="lat"/>
    <result column="lng"        property="lng"/>
    <result column="build_year" property="buildYear"/>
</resultMap>

<select id="selectHouseDetail"
        parameterType="string"
        resultMap="HouseDetailResult">
    SELECT apt_seq,
        apt_name,
        dong,
        lat,
        lng,
        build_year
    FROM house_detail
    WHERE apt_seq = #{aptSeq}
</select>

<!-- 3) 거래 내역 전체 조회 -->
<select id="selectHouseDeals"
        parameterType="string"
        resultType="com.ssafy.house.model.dto.HouseDeal">
    SELECT deal_id,
        apt_seq,
        price,
        floor,
        deal_date
    FROM house_deal
    WHERE apt_seq = #{aptSeq}
    ORDER BY deal_date DESC
</select>

<!-- 4) 이미지 목록 조회 -->
<select id="selectHouseImages"
        parameterType="string"
        resultType="com.ssafy.house.model.dto.HouseImage">
    SELECT img_id,
        apt_seq,
        img_url,
        description
    FROM house_image
    WHERE apt_seq = #{aptSeq}
</select>

<!-- 5) 학군 요약 정보 조회 -->
<select id="selectHouseSchools"
        parameterType="string"
        resultType="com.ssafy.house.model.dto.HouseSchool">
    SELECT school_id,
        apt_seq,
        school_name,
        distance
    FROM house_school
    WHERE apt_seq = #{aptSeq}
</select>

</mapper>
